<!doctype html>
<html>

<head>
  <meta charset="utf-8" name="viewport" content="width=device-width, user-scalable=no">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/viewerjs@1.10.1/dist/viewer.min.css">
  <link rel="stylesheet" href="./style.css">
  <script src="https://cdn.jsdelivr.net/npm/viewerjs@1.10.1/dist/viewer.min.js"></script>
</head>

<body>
  <div class="map" data-map></div>

  <select class="map-select" data-controls-switcher></select>

  <div class="map-switcher">
    <button class="map-switcher__button map-switcher__button_active" data-controls-switch="current">
      Текущий генплан
    </button>

    <button class="map-switcher__button" data-controls-switch="new">
      Новый генплан
    </button>
  </div>

  <button class="legend-button">Легенда</button>

  <div class="zoom">
    <button class="zoom__button zoom__button_plus" data-controls-zoom-in title="Увеличить масштаб (+)">&#43;</button>
    <button class="zoom__button zoom__button_minus" data-controls-zoom-out
      title="Уменьшить масштаб (-)">&#8722;</button>
  </div>

  <script>
    const PLANS = [
      {
        title: "Старый генплан",
        map: "plan-current",
        legend: "legend-new",
        old: true
      },
      {
        title: "Фукнциональные зоны",
        map: "plan-functional-zones",
        legend: "legend-new"
      },
      {
        title: "Общественный транспорт",
        map: "plan-public-transport",
        legend: "legend-new"
      },
      {
        title: "Транспортная инфраструктура",
        map: "plan-transport-infrastructure",
        legend: "legend-new"
      }
    ];

    const VIEWER_ZOOM_RATIO = 0.5;

    const mapContainer = document.querySelector('[data-map]')
    const zoomInButton = document.querySelector('[data-controls-zoom-in]');
    const zoomOutButton = document.querySelector('[data-controls-zoom-out]');
    const planSelect = document.querySelector('[data-controls-switcher]');

    const image = new Image();
    image.src = getImagePath(PLANS.find(plan => plan.old).map);
    image.style.opacity = '.001';
    mapContainer.appendChild(image);

    const viewer = new Viewer(image, {
      title: false,
      navbar: false,
      backdrop: false,
      toolbar: false,
      fullscreen: false,
      button: false,
      inline: true,
      keyboard: false,
      rotatable: false,
      scalable: false,
      slideOnTouch: false,
      tooltip: false,
      transition: true,
      zoomRatio: VIEWER_ZOOM_RATIO,
      maxZoomRatio: 1.6,
      minZoomRatio: .15
    });

    viewer.show();

    zoomInButton.addEventListener('click', () => {
      viewer.zoom(VIEWER_ZOOM_RATIO);
    });

    zoomOutButton.addEventListener('click', () => {
      viewer.zoom(-VIEWER_ZOOM_RATIO);
    });

    document.addEventListener('keyup', ({ key }) => {
      switch (key) {
        case "-":
          viewer.zoom(-VIEWER_ZOOM_RATIO);
          break;

        case "=":
          viewer.zoom(VIEWER_ZOOM_RATIO);
          break;

        case "0":
          viewer.reset();
          break;
        default: ;
      }
    });

    PLANS.filter(plan => !plan.old).map(plan => {
      const option = document.createElement('option');
      option.text = plan.title;
      option.value = plan.title;
      planSelect.appendChild(option)
    });

    planSelect.addEventListener('change', (e) => {
      console.log(e.target.value)
      setMap(e.target.value);
    })

    function setMap(title) {
      const image = getImagePath(PLANS.find(plan => title === plan.title).map);
      document.querySelector('.viewer-canvas img').src = image;
    }

    function getImagePath(image) {
      return `./images/${image}.jpg`;
    }
  </script>
</body>


</html>
